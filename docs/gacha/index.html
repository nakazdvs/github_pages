<!doctype html>
<html>
<head>
<meta charset="UTF-8">
<title>無題ドキュメント</title>
<meta name="viewport" content="width=devise-width, user-scalable=no, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0">
<link rel="stylesheet" href="./css/gacha.css">
</head>
<body>

<div id="vueGachaApp" class="gacha_app">
	<gacha-body :obj="gachaObj"></gacha-body>
	<a href="#" @click="change">スタート</a>
</div>

<!--div id="gacha-app">
<transition mode="out-in">
	<start-overlay @gacha="start" v-if="stop"></start-overlay>
</transition>
<gacha-body ref="body"></gacha-body>
</div-->

<script src="https://unpkg.com/vue/dist/vue.min.js" as="script"></script>
<script>
'use strict'
const gachaBody = Vue.extend({
	template: `
		<div class="gacha_frame">
			<div class="gacha_body" :class="upperSlide" ref="wrap">
				<img src="./img/gacha_body.png" class="body">
				<div class="hide_capsule_wrap">
					<img src="./img/gacha_effect.png" class="effect" :class="flash" ref="effect">
					<img src="./img/gacha_capsule_g.png" class="capsule" :class="drop">
				</div>
				<img src="./img/gacha_front.png" class="front">
				<img src="./img/gacha_handle.png" class="handle" :class="rotate" ref="handle">
			</div>
			<component :is="result" :obj="resultObj"></component>
		</div>
	`,
	data() {
		return {
			isRotated: false,
			isTranslated: false,
			result: 'jackpot',
			resultObj: {
				isResult: false
			}
		}
	},
	props: {
		obj: {
			type: Object
		}
	},
	components: {
		'jackpot': {
			template: `<div class="result_jackpot" :class="open"></div>`,
			props: {
				obj: {
					type: Object
				},
			},
			computed: {
				open() {
					return {
						open: this.obj.isResult
					}
				}
			}
		},
	},
	computed: {
		rotate() {
			return {
				rotate: this.obj.isStart
			}
		},
		upperSlide() {
			return {
				slideup: this.isRotated
			}
		},
		drop() {
			return {
				drop: this.isTranslated
			}
		},
		flash() {
			return {
				flash: this.isTranslated
			}
		}
	},
	mounted(){
		this.rotated()
		this.translated()
		this.gachad()
	},
	methods: {
		rotated() {
			const handle = this.$refs.handle
			handle.addEventListener('animationend',(e) => {
				this.isRotated = true
				e.stopPropagation()
			})
		},
		translated() {
			const wrap = this.$refs.wrap
			wrap.addEventListener('animationend',() => {
				this.isTranslated = true
			})
		},
		gachad() {
			const effect = this.$refs.effect
			effect.addEventListener('animationend',() => {
				this.$set(this.resultObj,"isResult",true)
			})
		}
	}
})

new Vue({
	el: "#vueGachaApp",
	data: {
		gachaObj: {
			isStart: false
		}
	},
	components: {
		gachaBody
	},
	methods: {
		change() {
			this.$set(this.gachaObj,"isStart",true)
		}
	}
})
/*
const startOverlay = Vue.extend({
	template: `
		<div class="start_overlay">
			<img src="./img/about.png" class="about">
			<a href="#" class="btn" @click.prevent="gacha"><img src="./img/btn-gacha.png"></a>
		</div>
	`,
	methods: {
		gacha() {
			this.$emit('gacha')
		}
	}
})
const gachaBody = Vue.extend({
	data() {
		return {
			isRotate: false,
			isZoom: false,
			isDrop: false,
			isFlash: false
		}
	},
	template: `
		<div class="gacha-body">
			<div class="wrap":class="{zoom:isZoom}" ref="wrap">
				<img src="./img/gacha-body.png" class="body">
				<div class="egg_wrap" :class="{drop:isDrop}">
					<img src="./img/gacha-egg-effect.png" class="effect" :class="{flash:isFlash}">
					<img src="./img/gacha-egg-g.png" class="egg">
				</div>
				<img src="./img/gacha-front.png" class="front">
				<img src="./img/gacha-handle.png" class="handle" :class="{rotate:isRotate}" ref="handle">
			</div>
		</div>
	`,
	methods: {
		rotate() {
			this.isRotate = true
			const handle = this.$refs.handle
			handle.addEventListener('animationend',(e) => {
				this.isZoom = true
				e.stopPropagation()
			})
			const wrap = this.$refs.wrap
			wrap.addEventListener('animationend',() => {
				this.isDrop = true
				this.isFlash = true
			})
		}
	}
})
new Vue({
	el: "#gacha-app",
	data: {
		stop: true
	},
	components: {
		startOverlay,
		gachaBody
	},
	methods: {
		start() {
			this.stop = false
			this.$refs.body.rotate()
		}
	}
});
*/
</script>
</body>
</html>
